{{ $paramDefault := .Site.Params.default_featured_image | default "images/default-featured.jpg" }}
{{ $rawImagePath := .Params.featured_image | default $paramDefault }}
{{ $scratch := newScratch }}
{{ partial "helpers/resource-image.html" (dict "path" $rawImagePath "page" . "size" "2500x q80" "scratch" $scratch) }}
{{ $imgUrl := $scratch.Get "img" }}
{{ $webpUrl := $scratch.Get "webp" }}
{{ $isLCP := .Scratch.Get "isLCP" | default false }}
<div class="mid-gray overflow-hidden pv3">
  <div class="flex flex-column">
    <div class="mb3 w-100">
      <a href="{{ .RelPermalink }}" class="db dim aspect-ratio aspect-ratio--16x9">
        <div class="img aspect-ratio--object overflow-hidden" style="position:absolute; inset:0;">
          <picture style="display:block; width:100%; height:100%;">
            {{ with $webpUrl }}
              <source type="image/webp" srcset="{{ . }}">
            {{ end }}
            <img
              src="{{ $imgUrl }}"
              alt=""
              decoding="async"
              {{ if $isLCP }}loading="eager" fetchpriority="high"{{ else }}loading="lazy"{{ end }}
              style="display:block; width:100%; height:100%; object-fit:cover; object-position:center;"
            >
          </picture>
        </div>
      </a>
    </div>
    <div class="w-100">
      {{ if .Date }}
        <div class="f7 dib ttu tracked">
          {{ .Date.Format "January 2, 2006" }}
        </div>
      {{ end }}
      <h1 class="f3 near-black">
        <a href="{{ .RelPermalink }}" class="link black dim">
          {{ .Title }}
        </a>
      </h1>
      <div class="nested-links f6 lh-copy nested-copy-line-height o-80">
        {{ if .Description }}
          {{ .Description | markdownify }}
        {{ else }}
          {{ .Summary }}
        {{ end }}
      </div>
    </div>
  </div>
</div>
