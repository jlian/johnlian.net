{{- $dest := strings.TrimPrefix "/" .Destination -}}
{{- $dest = strings.TrimPrefix "./" $dest -}}
{{- $webpPath := replaceRE "\\.[^.]+$" ".webp" $dest -}}
{{- $webpExists := fileExists (printf "static/%s" $webpPath) -}}
{{- $src := .Destination | relURL -}}

{{- if $webpExists -}}
<picture>
  <source srcset="{{ printf "/%s" $webpPath | relURL }}" type="image/webp">
  <img src="{{ $src }}" alt="{{ .Text }}"{{ with .Title }} title="{{ . }}"{{ end }} loading="lazy">
</picture>
{{- else -}}
<img src="{{ $src }}" alt="{{ .Text }}"{{ with .Title }} title="{{ . }}"{{ end }} loading="lazy">
{{- end -}}
