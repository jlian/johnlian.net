{{ $.Scratch.Add "labelClasses" "f6 b db mb1 mt3 sans-serif dark-gray" }}
{{ $.Scratch.Add "inputClasses" "w-100 f5 pv3 ph3 bg-light-gray bn" }}
{{/* Prefer shortcode param, then site params */}}
{{ $turnstileSiteKey := .Get "turnstileSiteKey" | default site.Params.turnstileSiteKey }}
{{ if eq $turnstileSiteKey ".Site.Params.turnstileSiteKey" }}{{ $turnstileSiteKey = "" }}{{ end }}

<div id="contact-success" class="dn pa3 mv3 bg-washed-green dark-green br2">
  Message sent. Iâ€™ll reply soon.
</div>
<div id="contact-error" class="dn pa3 mv3 bg-washed-red dark-red br2">
  Something went wrong sending your message. Please try again later.
</div>

<form class="black-80 sans-serif" accept-charset="UTF-8" action="/api/contact" method="POST" role="form" name="contact">

    <label class="{{ $.Scratch.Get "labelClasses" }}"  for="name">Your Name</label>
    <input type="text" id="name" name="name" class="{{ $.Scratch.Get "inputClasses" }}"  required placeholder=" "  aria-labelledby="name"/>

    <label class="{{ $.Scratch.Get "labelClasses" }}" for="email">Email Address</label>
    <input type="email" id="email" name="email" class="{{ $.Scratch.Get "inputClasses" }}"  required placeholder=" "  aria-labelledby="email"/>
    <div class="requirements f6 gray glow i ph3 overflow-hidden">
      An email address is required.
    </div>

    <label class="{{ $.Scratch.Get "labelClasses" }}" for="message">Message</label>
    <textarea id="message" name="message" class="{{ $.Scratch.Get "inputClasses" }} h4" aria-labelledby="message"></textarea>

    {{ if $turnstileSiteKey }}
    <div class="mt3">
      <div class="cf-turnstile" data-sitekey="{{ $turnstileSiteKey }}"></div>
    </div>
    {{ end }}

    <div class="shadow-hover">
      <input class="db w-100 mv2 white pa3 bn hover-bg-black bg-animate bg-dark-gray" type="submit" value="Send" />
    </div>

</form>
{{ if $turnstileSiteKey }}
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
{{ end }}
<script>
  (function () {
    var params = new URLSearchParams(window.location.search);
    var success = document.getElementById("contact-success");
    var error = document.getElementById("contact-error");

    if (params.get("sent") === "1" && success) {
      success.classList.remove("dn");
      success.scrollIntoView({ behavior: "smooth", block: "start" });
    } else if (params.get("error") === "1" && error) {
      error.classList.remove("dn");
      error.scrollIntoView({ behavior: "smooth", block: "start" });
    } else {
      return;
    }

    params.delete("sent");
    params.delete("error");
    var newUrl =
      window.location.pathname +
      (params.toString() ? "?" + params.toString() : "") +
      window.location.hash;
    history.replaceState({}, "", newUrl);
  })();
</script>
