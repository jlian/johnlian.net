{{ $.Scratch.Add "labelClasses" "f6 b db mb1 mt3 sans-serif dark-gray" }}
{{ $.Scratch.Add "inputClasses" "w-100 f5 pv3 ph3 bg-light-gray bn" }}
{{/* Prefer shortcode param, then site params */}}
{{ $turnstileSiteKey := .Get "turnstileSiteKey" | default site.Params.turnstileSiteKey }}
{{ if eq $turnstileSiteKey ".Site.Params.turnstileSiteKey" }}{{ $turnstileSiteKey = "" }}{{ end }}

<noscript>
  <div class="pa3 mv3 bg-washed-yellow dark-gray br2">
    This contact form requires JavaScript enabled to submit.
  </div>
</noscript>

<form
  class="black-80 sans-serif"
  accept-charset="UTF-8"
  action="/api/contact"
  method="POST"
  role="form"
  name="contact"
  hx-post="/api/contact"
  hx-target="#contact-messages"
  hx-swap="outerHTML"
>

    <label class="{{ $.Scratch.Get "labelClasses" }}"  for="name">Your Name</label>
    <input type="text" id="name" name="name" class="{{ $.Scratch.Get "inputClasses" }}"  required placeholder=" "  aria-labelledby="name"/>

    <label class="{{ $.Scratch.Get "labelClasses" }}" for="email">Email Address</label>
    <input type="email" id="email" name="email" class="{{ $.Scratch.Get "inputClasses" }}"  required placeholder=" "  aria-labelledby="email"/>
    <div class="requirements f6 gray glow i ph3 overflow-hidden">
      An email address is required.
    </div>

    <label class="{{ $.Scratch.Get "labelClasses" }}" for="message">Message</label>
    <textarea id="message" name="message" class="{{ $.Scratch.Get "inputClasses" }} h4" aria-labelledby="message"></textarea>

    {{ if $turnstileSiteKey }}
    <div class="mt3">
      <div class="cf-turnstile" data-sitekey="{{ $turnstileSiteKey }}"></div>
    </div>
    {{ end }}

    <div class="shadow-hover">
      <input class="db w-100 mv2 white pa3 bn hover-bg-black bg-animate bg-dark-gray" type="submit" value="Send" />
    </div>

</form>

<div id="contact-messages">
  <div id="contact-success" class="dn pa3 mv3 bg-washed-green dark-green br2">
    Message sent successfully. Thank you for reaching out!
  </div>
  <div id="contact-error" class="dn pa3 mv3 bg-washed-red dark-red br2">
    Something went wrong sending your message. Please try again later.
  </div>
</div>
{{ if $turnstileSiteKey }}
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
{{ end }}
<script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js" integrity="sha384-/TgkGk7p307TH7EXJDuUlgG3Ce1UVolAOFopFekQkkXihi5u/6OCvVKyz1W+idaz" crossorigin="anonymous" defer></script>

<script>
  // Allow the server to return real HTTP error status codes while still
  // swapping the returned HTML fragment into the page.
  document.body.addEventListener("htmx:beforeSwap", function (evt) {
    // Respect explicit "no content" responses.
    if (evt.detail.xhr && evt.detail.xhr.status === 204) {
      return;
    }

    if (evt.detail.isError) {
      evt.detail.shouldSwap = true;
      evt.detail.isError = false;
    }
  });
</script>
